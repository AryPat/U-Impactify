<div class="flexbot">
  <div class="outer" *ngIf="course">
    <div
      class="courseimage"
      style="background-image: url('{{ course.img }}')"
    ></div>
    <h4 id="title2">{{ course.name }}</h4>
  </div>

  <!-- TEACHER -->
  <div
    class="test"
    *ngIf="!!user && course && course.teachers.includes(user._id)"
  >
    <div class="box-shadow-2" id="add1">
      <h6 class="child">Name</h6>
      <h6 class="child">Assessment</h6>
      <h6 class="child">Visibility</h6>
      <h6 class="child">Submission</h6>
    </div>

    <div class="box-shadow-2" id="addout" *ngFor="let assess of assessArr">
      <div class="trash">
        <clr-icon class="editt" shape="note"></clr-icon>
        <clr-icon
          class="nono"
          shape="trash"
          (click)="onDelete(assess)"
        ></clr-icon>
      </div>
      <div id="add2">
        <div class="content">
          <span class="h6">{{ assess.name }}</span>
        </div>
        <div class="content">
          <div *ngFor="let file of assess.files">
            <a
              *ngIf="file"
              download="{{ file.name }}"
              href="http://localhost:5000/api/course/documents/{{ file.id }}"
              >{{ file.name }}</a
            >
          </div>
        </div>
        <div class="content">
          <div *ngIf="assess.visibility">
            <img src="../../../assets/stalkhehe.png" width="25" height="15" />
          </div>
          <div *ngIf="!assess.visibility">
            <img src="../../../assets/nopeak.png" width="25" height="15" />
          </div>
        </div>
        <div class="content">
          <clr-icon
            shape="view-list"
            id="submissionsTab"
            (click)="showStudentSubmission(assess)"
          ></clr-icon>
        </div>
      </div>
    </div>

    <button
      class="box-shadow-2"
      id="add2"
      [ngStyle]="{
        border: '2px var(--gray40) dashed',
        margin: '3rem',
        width: 'calc(100% - 4rem)'
      }"
      (click)="createNewAssessmentModal = true"
    >
      <h5 class="new">Create New Assessment</h5>
    </button>
  </div>

  <!-- IMPACT LEARNER  -->
  <div class="test" *ngIf="user.type == 'IL'">
    <div class="box-shadow-2" id="add1">
      <h6 class="child">Name</h6>
      <h6 class="child">Assessment</h6>
      <h6 class="child">File Upload</h6>
      <h6 class="child">View submission(s)</h6>
    </div>

    <div
      *ngIf="assessArr.length == 0"
      class="box-shadow-2"
      id="addout"
      [ngStyle]="{
        border: '2px var(--gray40) dashed',
        margin: '3rem',
        width: 'calc(100% - 4rem)'
      }"
    >
      <h5 class="new">Horay no Assessment(s)</h5>
    </div>
    <div
      class="box-shadow-2"
      id="addout"
      *ngFor="let assess of assessArr; let i = index"
    >
      <div class="trash-2"></div>
      <div id="add2">
        <div class="content">
          <span class="h6">{{ assess.name }}</span>
        </div>
        <div class="content">
          <div *ngFor="let file of assess.files">
            <a
              *ngIf="file"
              download="{{ file.name }}"
              href="http://localhost:5000/api/course/documents/{{ file.id }}"
              >{{ file.name }}</a
            >
          </div>
        </div>

        <div class="content">
          <clr-icon
            shape="view-list"
            id="submissionsTab"
            (click)="submissionsModal = true; selectedAss = assess"
          ></clr-icon>
        </div>

        <div class="content">
          <div *ngFor="let file of viewSelfSubmissions[i]">
            <a
              *ngIf="file.name"
              download="{{ file.name }}"
              href="http://localhost:5000/api/course/documents/{{ file.id }}"
            >
              {{ file.name }}
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- IMPACT LEARNER -->
    <div *ngIf="user.type == 'IL'">
      <clr-datagrid id="table">
        <clr-dg-column class="widthDefault"
          ><div id="header">Name</div></clr-dg-column
        >
        <clr-dg-column class="widthDefault"
          ><div id="header">Assessment</div></clr-dg-column
        >
        >
        <clr-dg-column class="widthDefault"
          ><div id="header">File Upload</div></clr-dg-column
        >

        <clr-dg-column class="widthDefault">
          <div id="header">View Submission</div>
        </clr-dg-column>

        <clr-dg-row *ngFor="let assess of assessArr; let i = index">
          <!-- <clr-dg-action-overflow>
          <button class="action-item" (click)="onEdit(assess)">Edit</button>
          <button class="action-item" (click)="onDelete(assess)">Delete</button>
        </clr-dg-action-overflow> -->

          <clr-dg-cell class="text widthColumn">
            {{ assess.name }}
          </clr-dg-cell>

          <clr-dg-cell class="widthColumn files">
            <!-- id="fileStore" -->
            <div class="row" *ngFor="let file of assess.files">
              <a
                *ngIf="file"
                download="{{ file.name }}"
                href="http://localhost:5000/api/course/documents/{{ file.id }}"
                >{{ file.name }}</a
              >
            </div>
          </clr-dg-cell>

          <!-- <clr-dg-cell>{{ assess.visibility }}</clr-dg-cell> -->

          <clr-dg-cell
            *ngIf="assess.visibility == 'true'"
            class="display widthColumnSmall"
          >
            <clr-icon shape="check" class="checkmark"></clr-icon>
            <div class="text"></div>
          </clr-dg-cell>

          <clr-dg-cell
            *ngIf="assess.visibility == 'false'"
            class="display widthColumnSmall"
            ><clr-icon shape="times" class="wrong"></clr-icon>
            <div class="text"></div>
          </clr-dg-cell>

          <clr-dg-cell class="text widthColumnSmall"
            ><clr-icon
              shape="view-list"
              id="submissionsTab"
              (click)="submissionsModal = true; selectedAss = assess"
            ></clr-icon>
          </clr-dg-cell>

          <clr-dg-cell class="widthColumnSmall">
            <div *ngFor="let file of viewSelfSubmissions[i]">
              <a
                *ngIf="file.name"
                download="{{ file.name }}"
                href="http://localhost:5000/api/course/documents/{{ file.id }}"
              >
                {{ file.name }}
              </a>
            </div>
          </clr-dg-cell>
        </clr-dg-row>
      </clr-datagrid>
    </div>

    <div *ngIf="submissionsModal == true && user.type == 'IL' && selectedAss">
      <clr-modal
        [(clrModalOpen)]="basic"
        [clrModalSize]="'lg'"
        [clrModalClosable]="false"
      >
        <h3 class="modal-title student-submission-title">
          Submission for {{ selectedAss.name }}
        </h3>
        <div class="modal-body">
          <form clrForm>
            <clr-control-error>{{ error }}</clr-control-error>

            <ngx-file-drop
              dropZoneLabel="Drop files here"
              (onFileDrop)="dropped($event)"
              (onFileOver)="fileOver($event)"
              (onFileLeave)="fileLeave($event)"
            >
              <ng-template
                ngx-file-drop-content-tmp
                let-openFileSelector="openFileSelector"
              >
                <label>Upload Assignment Files</label>
                <button class="btn btn-primary" (click)="openFileSelector()">
                  Browse Files
                </button>

                <!-- <button type="button" (click)="openFileSelector()">Browse Files</button> -->
              </ng-template>
            </ngx-file-drop>
            <div class="upload-table">
              <table class="table">
                <thead>
                  <tr>
                    <th>Name of file(s) uploaded:</th>
                  </tr>
                </thead>
                <tbody class="upload-name-style">
                  <tr *ngFor="let item of files; let i = index">
                    <td>
                      <strong>{{ item.relativePath }}</strong>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-outline"
            (click)="submissionsModal = false"
            (click)="cancel()"
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-primary"
            (click)="submitHandler()"
          >
            Submit
          </button>
        </div>
      </clr-modal>
    </div>

    <div *ngIf="createNewAssessmentModal">
      <clr-modal
        [(clrModalOpen)]="basic"
        [clrModalSize]="'lg'"
        [clrModalClosable]="false"
      >
        <h3 class="modal-title">{{ title }}</h3>
        <div class="modal-body">
          <form clrForm>
            <clr-control-error>{{ error }}</clr-control-error>

            <clr-input-container>
              <label
                >Assessment name
                <input
                  clrInput
                  type="text"
                  [(ngModel)]="name"
                  name="name"
                  required
                />
              </label>
              <clr-control-error>This field is required!</clr-control-error>
            </clr-input-container>

            <clr-radio-container>
              <label>Visibliity</label>
              <clr-radio-wrapper>
                <input
                  type="radio"
                  clrRadio
                  name="true"
                  required
                  value="true"
                  [(ngModel)]="visibility"
                />
                <label class="rlabel">True</label>
              </clr-radio-wrapper>
              <clr-radio-wrapper>
                <input
                  type="radio"
                  clrRadio
                  name="false"
                  required
                  value="false"
                  [(ngModel)]="visibility"
                />
                <label class="rlabel">False</label>
              </clr-radio-wrapper>

              <clr-control-error
                >Please choose whether or not you want it to be
                seen!</clr-control-error
              >
            </clr-radio-container>

            <ngx-file-drop
              dropZoneLabel="Drop files here"
              (onFileDrop)="dropped($event)"
              (onFileOver)="fileOver($event)"
              (onFileLeave)="fileLeave($event)"
            >
              <ng-template
                ngx-file-drop-content-tmp
                let-openFileSelector="openFileSelector"
              >
                <label>Upload Assignment Files</label>
                <button class="btn btn-primary" (click)="openFileSelector()">
                  Browse Files
                </button>

                <!-- <button type="button" (click)="openFileSelector()">Browse Files</button> -->
              </ng-template>
            </ngx-file-drop>
            <div class="upload-table">
              <table class="table">
                <thead>
                  <tr>
                    <th>Name of file(s) uploaded:</th>
                  </tr>
                </thead>
                <tbody class="upload-name-style">
                  <tr *ngFor="let item of files; let i = index">
                    <td>
                      <strong>{{ item.relativePath }}</strong>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-outline"
            (click)="createNewAssessmentModal = false"
            (click)="cancel()"
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-primary"
            (click)="registerHandler()"
            (click)="createNewAssessmentModal = false"
          >
            Create Assessment
          </button>
        </div>
      </clr-modal>
    </div>
  </div>
</div>
